# Generated by Chef

# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

# The loopback network interface
auto lo
iface lo inet loopback

<% if @interface.match(/bond/) -%>
<% @bonded_interfaces.each do |bonded_interface| -%>
auto <%= bonded_interface %>
iface <%= bonded_interface %> inet manual
  bond-master <%= @interface %>
<% if @bond_mode == 1 && bonded_interface == @bonded_interfaces.first -%>
  bond-primary <%= @bonded_interfaces.first %>
<% end -%>

<% end -%>
<% end -%>

# The primary network interface
<% if @interface != 'eth0' -%>
auto eth0
iface eth0 inet dhcp

# The secondary interface
auto <%= @interface %>
iface <%= @interface %> inet static
  address <%= node['network']['interfaces'][@interface]['addresses'].keys[1] %>
  # The ucarp interface
  ucarp-vid <%= @vid %>
  ucarp-vip <%= @vip %>
  ucarp-password <%= @password %>
  ucarp-advskew <%= @advskew %>
  ucarp-advbase <%= @advbase %>
  ucarp-master <%= @master %>

iface <%= @interface %>:ucarp inet static
  address <%= @vip %>
  netmask <%= @netmask %>
<% else -%>
auto <%= @interface %>
iface <%= @interface %> inet static
  address <%= node['ipaddress']
  netmask <%= node['network']['interfaces'][node['network']['default_interface']]['addresses'][node['ipaddress']]['netmask'] %>
  gateway <%= node['network']['default_gateway'] %>
  ucarp-vid <%= @vid %>
  ucarp-vip <%= @vip %>
  ucarp-password <%= @password %>
  ucarp-advskew <%= @advskew %>
  ucarp-advbase <%= @advbase %>
  ucarp-master <%= @master %>
<% if @interface.match(/bond/) -%>
  bond-slaves none
  bond_mode <%= @bond_mode %>
  bond_miimon 100
<% end -%>

iface <%= @interface %>:ucarp inet static
  address <%= @vip %>
  netmask <%= @netmask %>
<% end -%>
